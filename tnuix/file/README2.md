# 寸关尺脉搏监测系统

## 项目简介
本系统是一个基于 FastAPI 和 WebSocket 的实时脉搏监测系统，可以同时监测寸、关、尺三个部位的脉搏数据。系统支持实际硬件采集和模拟数据测试两种模式。

## 功能特点
- 实时数据采集和显示
- 多通道（寸关尺）同步监测
- 数据可视化和波形分析
- 异常状态自动检测和警报
- 支持实际硬件和模拟数据测试
- 用户认证和会话管理
- 数据过滤和信号处理

## 安装指南

### 环境要求
- Python 3.8 或更高版本
- Windows/Linux/MacOS 操作系统
- 网络浏览器（推荐 Chrome/Firefox）

### 安装步骤

1. **创建并激活虚拟环境**
```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# Linux/MacOS
python3 -m venv .venv
source .venv/bin/activate
```

2. **安装依赖**
```bash
python -m pip install -r requirements.txt
```

3. **运行程序**
```bash
python main.py
```

4. **访问系统**
- 本地访问：http://localhost:8000
- 远程访问：http://[服务器IP]:8000

### 默认登录信息
- 用户名：admin
- 密码：admin123

## 使用说明

### 1. 数据采集模式

#### 模拟数据模式
- 选择 DEBUG_COM1/2/3 任意一个虚拟串口
- 系统会自动生成模拟数据用于测试
- 每30秒自动切换正常/异常状态

#### 实际硬件模式
- 连接 STM32 开发板
- 选择对应的串口和波特率
- 数据格式：timestamp,cun_value,guan_value,chi_value[,pulse_rate]

### 2. 界面说明

#### 控制面板
- 串口选择下拉框
- 波特率设置
- 连接/断开按钮
- 数据源指示器
- 实时状态显示

#### 数据显示
- 三个独立的波形图表（寸、关、尺）
- 实时脉率显示
- 采样率显示
- 状态指示器

### 3. 数据范围说明

#### 正常范围
- 寸部：-0.5 ~ 1.5
- 关部：-0.4 ~ 1.2
- 尺部：-0.3 ~ 0.9
- 脉率：60 ~ 100 次/分

#### 警告范围
- 寸部：-1.0 ~ 2.0
- 关部：-0.8 ~ 1.6
- 尺部：-0.6 ~ 1.2
- 脉率：50 ~ 110 次/分

## 开发文档

### 项目结构
```
tnuix/
├── app/
│   ├── api/          # API接口
│   ├── core/         # 核心配置
│   ├── models/       # 数据模型
│   ├── services/     # 业务服务
│   ├── utils/        # 工具函数
│   └── templates/    # 前端模板
├── main.py          # 主程序
└── requirements.txt # 依赖清单
```

### 核心模块说明

#### 1. 串口服务 (serial_service.py)
- 串口连接管理
- 数据读取和解析
- 数据缓冲处理
- 异常处理机制

#### 2. 认证服务 (auth.py)
- 用户认证
- 会话管理
- 权限控制

#### 3. 数据处理
- 数字滤波
- 信号处理
- 异常检测

#### 4. WebSocket通信
- 实时数据推送
- 连接管理
- 心跳检测

### API接口

#### 1. 认证接口
- POST /login：用户登录
- GET /logout：退出登录
- GET /api/user：获取用户信息

#### 2. 串口管理
- GET /api/ports：获取可用串口列表
- POST /api/connect：连接串口
- POST /api/disconnect：断开连接
- GET /api/status：获取连接状态

#### 3. WebSocket
- WS /ws：实时数据推送

## 常见问题

### 1. 连接问题
Q: 无法连接到串口？
A: 检查串口是否被其他程序占用，或尝试使用管理员权限运行程序。

### 2. 数据显示问题
Q: 数据显示不完整或延迟？
A: 检查网络连接，或刷新页面重新建立WebSocket连接。

### 3. 权限问题
Q: 遇到权限相关错误？
A: 确保以管理员身份运行程序，或检查用户权限设置。

## 更新日志

### v1.0.0
- 基础功能实现
- 支持实时数据显示
- 添加用户认证
- 支持模拟数据测试

## 联系方式
如有问题或建议，请联系开发团队。

## 许可证
MIT License 